<!doctype html>
<!--[if lt IE 7]>
<html class="lt-ie9 lt-ie8 lt-ie7" lang="en-US"> <![endif]-->
<!--[if IE 7]>
<html class="lt-ie9 lt-ie8" lang="en-US"> <![endif]-->
<!--[if IE 8]>
<html class="lt-ie9" lang="en-US"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en-US">
<!--<![endif]-->

<head>
    <!-- META TAGS -->
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>个人中心</title>

    <!-- Style Sheet-->
    <link rel='stylesheet' id='bootstrap-css-css' href='css/bootstrap5152.css?ver=1.0' type='text/css' media='all'/>
    <link rel='stylesheet' id='responsive-css-css' href='css/responsive5152.css?ver=1.0' type='text/css' media='all'/>
    <link rel='stylesheet' id='main-css-css' href='css/main5152.css?ver=1.0' type='text/css' media='all'/>
    <!--<link rel='stylesheet' id='custom-css-css' href='../css/custom5152.css?ver=1.0' type='text/css' media='all' />-->


</head>

<body>
<!--导航 starts-->
<div style="background-color: snow" id="header">
    <div id="headerMain">
        <a href="index.html" id="logo">
            <img src="img/logo-red.png">
        </a>
        <ul id="nav">
            <li>
                <a href="javascript:">
                    <div class="up"><img src="img/home_gruen.png"></div>
                    <div><img src="img/home_red.png"></div>
                </a>
            </li>
            <li>
                <a href="#">
                    <div class="up"></div>
                    <div>红色地图</div>
                </a>
            </li>
            <li>
                <a href="great.html" >
                    <div class="up"></div>
                    <div>红色人物</div>
                </a>
            </li>
            <li>
                <a href="secnics.html">
                    <div class="up"></div>
                    <div>红色景点</div>
                </a>
            </li>
            <li>
                <a href="articles-list.html" class="active">
                    <div>寻迹红色</div>
                </a>
            </li>
            <li class="enter">
                <!-- 未登录时登录 -->
                <div id="unLogin">
                    <a href="netlogin.html">登录</a> |
                    <a href="netregister.html">注册</a>

                </div>
                <!-- 已登录时显示 -->
                <div id="alreadyLogin">
                    <span id="name" style="cursor: pointer;">null</span>
                    <span id="loginOut" style="margin-left: 10px;cursor: pointer">退出</span>
                </div>
            </li>
        </ul>
        <div id="arrow"></div>
    </div>
</div>
<!--导航 ends-->
<!-- 顶部 -->
<div class="header-wrapper">

    <!-- 顶部 搜索框 -->
    <div class="search-area-wrapper">
        <div class="search-area container">
        </div>
    </div>
    <!-- 搜索框 -->


<!-- 内容 -->
<div class="page-container">
    <div class="container">

        <ul class="breadcrumb">
            <li><a href="articles-list.html">活动广场</a><span class="divider">/</span></li>
            <li class="active">个人中心</li>
        </ul>

        <!-- 页面内容 -->
        <div class="selfCenter">
            <!--个人中心 顶部-->
            <div class="sC-information">
                <div class="img-width">
                <img src="img/support.png">
                </div>
                <div class="float-left">
                    <a href="#">
                        <h3 id="userName" class="title"></h3>
                    </a>
                    <h4 id="signature" class="intro"></h4>
                </div>
                <!--<div class="btn-change">-->
                <!--<a href="#" title="修改资料"><button value="btn-change"><strong>退出登录</strong></button></a>-->
                <!--</div>-->
            </div>
            <!--选项栏-->
            <div class="sC-container">
                <!-- 右侧信息 -->
                <aside class="sC-choose page-sidebar">

                    <section class="widget">
                        <!--个人中心-->
                        <div class="support-text">
                            <ul>
                                <li>
                                    <a href="center.html">
                                        <p>个人中心</p>
                                    </a>
                                </li>
                                <!--新增 start-->
                                <li>
                                    <a href="changePassword.html">
                                        <p>修改密码</p>
                                    </a>
                                </li>
                                <!--新增 end-->
                                <li>
                                    <a href="myFavorite.html">
                                        <p>我的收藏</p>
                                    </a>
                                </li>
                                <li>
                                    <a href="comment.html">
                                        <p>与我相关</p>
                                    </a>
                                </li>
                                <li><a href="myComment.html">
                                    <p>我的评论</p>
                                </a>
                                </li>
                                <li>
                                    <a href="history.html">
                                        <p>浏览记录</p>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </section>
                </aside>
                <!--个人中心 end -->

                <!--内容面板-->
                <div class="sC-appear">
                    <!--新增 manInfo.html start-->
                    <!--用户名-->
                    <div class="sCInfo">
                        <span>昵&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：</span>
                        <input id="nameShow" name="uName" type="text" value="" maxlength="6">
                    </div>
                    <!--个性签名-->
                    <div class="sCInfo">
                        <span>个性签名：</span>
                        <input id="signatureShow" name="uSignature" type="text" value="" maxlength="20">
                    </div>
                    <!--性别-->
                    <div class="sCInfo">
                        <span>性 &ThickSpace; &ThickSpace; &ThickSpace; 别：</span>
                        <select id="sexShow">
                            <option value="null">--</option>
                            <option value="male">男</option>
                            <option value="female">女</option>
                        </select>
                    </div>
                    <!--出生日期-->
                    <div class="sCInfo">
                        <span>出生日期：</span>
                        <!--新增-修改 ‘--’》null start-->
                        <select id="yearShow">
                            <option value="null">--</option>
                            <option value="1990">1990</option>
                            <option value="1991">1991</option>
                            <option value="1992">1992</option>
                            <option value="1993">1993</option>
                            <option value="1994">1994</option>
                            <option value="1995">1995</option>
                            <option value="1996">1996</option>
                            <option value="1997">1997</option>
                            <option value="1998">1998</option>
                            <option value="1999">1999</option>
                            <option value="2000">2000</option>
                            <option value="2001">2001</option>
                            <option value="2002">2002</option>
                            <option value="2003">2003</option>
                            <option value="2004">2004</option>
                            <option value="2005">2005</option>
                        </select>年
                        <select id="monthShow">
                            <option value="null">--</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                        </select>月
                        <select id="dayShow">
                            <option value="null">--</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                        </select>日
                    </div>
                    <!--联系电话-->
                    <div class="sCInfo">
                        <span>联系电话：</span>
                        <input id="talShow" name="uTel" type="text" value="" minlength="11" maxlength="11">
                    </div>
                    <!--联系地址-->
                    <div class="sCInfo">
                        <span>联系地址：</span>
                        <input id="addressShow" name="uAddress" type="text" value="">
                    </div>
                    <!--邮箱地址-->
                    <div class="sCInfo">
                        <span>邮箱地址：</span>
                        <input id="emailHeadShow" name="uEmail" type="text" value="">@
                        <select id="emailTailShow">
                            <option value="null">--</option>
                            <option>qq.com</option>
                            <option>163.com</option>
                            <option>126.com</option>
                            <option>139.com</option>
                        </select>
                    </div>
                    <!--新增btn start-->
                    <div class="sCInfo">
                        <div class="btn-change2">
                            <button onclick="updateUserMsg()">保存修改</button>
                        </div>
                    </div>
                    <!--新增 end-->
                </div>
            </div>
        </div>
    </div>
    <!-- end of sidebar -->
</div>
<footer class="foot">
    <p>版权&copy;嘉应学院&nbsp;|&nbsp;地理科学与旅游学院&nbsp;|&nbsp;GIS专业&nbsp;|&nbsp;219团队<br>
        地址：广东省梅州市梅松路嘉应学院校本部&nbsp;&nbsp;邮编：514000&nbsp;&nbsp;维护：219团队<br>
        申明：本网页不做任何商业用途，只做教学实验，最终解释权归团队所有！
    </p>
</footer>
<a href="#top" id="scroll-top"></a>

<!-- script -->
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery-1.11.3.min.js"></script>
<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/owl.carousel.js"></script>
<script src="js/jquery.mixitup.js" type="text/javascript"></script>
<script type="text/javascript" src="js/jquery.quovolver.js"></script>
    <script src="layer/layer.js"></script>
<script>
    $(document).ready(function () {
            //获得登录状态
        $.post("/user/checkUserstatus", {}, function (result) {
            if (result.code == 1) { //用户已登录
                $("#unLogin").hide();
                $("#alreadyLogin").show();
                //取得用户昵称
                var name = result.data.uname;
                var sex = result.data.sex;
                if (name == null) {
                    $("#name").html("请设置昵称");
                    $("#userName").append("昵称未设置");
                    setTimeout(function(){
                        layer.msg('您的昵称尚未设置，为了不影响您的正常使用，  请前往个人中心设置相关信息!');
                    }, 1000);
                } else {
                    $("#name").html(name);
                    $("#userName").append(name);
                }
                $("#signature").html(result.data.signature);
                $("#nameShow").attr("value", name);
                $("#signatureShow").attr("value", result.data.signature);
                $("#talShow").attr("value", result.data.tal);
                $("#addressShow").attr("value", result.data.address);

                if (sex == 0) {//男
                    $("#sexShow").val("male");
                } else if (sex == 1) {//女
                    $("#sexShow").val("female");
                }
                if (result.data.birthday != null) {
                    var arr = split(result.data.birthday, "-");
                    $("#yearShow").val(arr[0]);
                    $("#monthShow").val(arr[1]);
                    $("#dayShow").val(arr[2]);
                }
                if (result.data.email != null) {
                    var arr = split(result.data.email, "@");
                    $("#emailHeadShow").val(arr[0]);
                    $("#emailTailShow").val(arr[1]);
                }
            } else {
                $("#alreadyLogin").hide();
                layer.msg('未登录，请登录后尝试！', {icon: 0});
                window.location.href = "netlogin.html";
            }
        }, "json");

    });

    // 切割,返回一个数组
    function split(str, match) {
        var arr;
        // 在每个match处进行分隔。
        arr = str.split(match);
        return (arr);
    }
    //提交修改个人信息
    function  updateUserMsg() {
        var name= $("#nameShow").val();
        if (name==""){
            layer.msg('昵称不能为空，请重新输入！', {icon: 0});
            return;
        }
        var signature= $("#signatureShow").val();
        var sex= $("#sexShow").val();
        if(sex=="female"){
            sex="1";
        }else if(sex=="male"){
            sex="0";
        }else{
            sex="null";
        }
        console.log(sex);
        var year= $("#yearShow").val();
        var mouth= $("#monthShow").val();
        var day= $("#dayShow").val();
        //出生日期年月日有一个不为空就必须完整，保证要么为null，要么年月日完整
        if(year!="null"||mouth!="null"||day!="null")
            if (year == "null" || mouth == "null" || day == "null") {
                layer.msg('出生日期必须完整，请重新输入！', {icon: 0});
                return;
            }
        var tal= $("#talShow").val();
        var address= $("#addressShow").val();
        var emailHead= $("#emailHeadShow").val();
        var emailTail= $("#emailTailShow").val();
        //邮箱有一个不为空就必须完整
        if(emailHead!=""||emailTail!="null")
            if(emailHead==""||emailTail=="null") {
                layer.msg('邮箱必须填写完整，请重新输入！', {icon: 0});
                return;
            }
        $.post("user/updateUserMag", {"name":name,"signature":signature,"sex":sex,"birthday":composeBirthday(year,mouth,day),"tal":tal,"address":address,"email":composeEmail(emailHead,emailTail)},
            function (result) {
            if(result.code==1){//修改成功
                layer.msg('信息修改成功！', {icon: 6});
                setTimeout(function(){
                    window.location.reload();
                }, 1000);
            }else{
                layer.msg('信息修改失败！', {icon: 5});
            }

        }, "json");

    }

//    组合出生日期
    function composeBirthday(year,mouth,day) {
        if(year == "null" && mouth == "null" && day == "null"){
            return null;
        }
        return year+"-"+mouth+"-"+day;
    }
    //    组合邮箱
    function composeEmail(emailHead,emailTail) {
        if(emailHead==""&&emailTail=="null"){
            return null;
        }
        return emailHead+"@"+emailTail;
    }


    //退出用户
    $("#loginOut").click(function () {
        $.post("/user/loginOut", {}, function (response) {
        }, "json");
        window.location.href = "articles-list.html";
    });

</script>
</body>
<!-- 
<script>
  $(function () {
    $('#manInfo').load("mainInfo.html");
  })
</script> -->


</html>
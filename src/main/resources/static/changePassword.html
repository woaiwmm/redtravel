<!doctype html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en-US"> <![endif]-->
<!--[if IE 7]>    <html class="lt-ie9 lt-ie8" lang="en-US"> <![endif]-->
<!--[if IE 8]>    <html class="lt-ie9" lang="en-US"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en-US">
<!--<![endif]-->

<head>
  <!-- META TAGS -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>个人中心</title>



  <!-- Style Sheet-->
  <link rel='stylesheet' href='css/login.css' type='text/css' />
  <link rel='stylesheet' id='bootstrap-css-css' href='css/bootstrap5152.css?ver=1.0' type='text/css' media='all' />
  <link rel='stylesheet' id='responsive-css-css' href='css/responsive5152.css?ver=1.0' type='text/css' media='all' />
  <link rel='stylesheet' id='main-css-css' href='css/main5152.css?ver=1.0' type='text/css' media='all' />
  <!--<link rel='stylesheet' id='custom-css-css' href='../css/custom5152.css?ver=1.0' type='text/css' media='all' />-->


</head>

<body>
  <!--新增-修改 导航栏 start-->
  <!-- <iframe style="display:block" src="nav.html" scrolling="no" frameborder="0" width="100%" height="80px"></iframe>-->

  <!--导航 starts-->
  <div style="background-color: snow" id="header">
    <div id="headerMain">
      <a href="index.html" id="logo">
        <img src="img/logo-red.png">
      </a>
      <ul id="nav">
        <li>
          <a href="javascript:">
            <div class="up"><img src="img/home_gruen.png"></div>
            <div><img src="img/home_red.png"></div>
          </a>
        </li>
        <li>
          <a href="#">
            <div class="up"></div>
            <div>红色地图</div>
          </a>
        </li>
        <li>
          <a href="great.html">
            <div class="up"></div>
            <div>红色人物</div>
          </a>
        </li>
        <li>
          <a href="secnics.html">
            <div class="up"></div>
            <div>红色景点</div>
          </a>
        </li>
        <li>
          <a href="articles-list.html" class="active">
            <div>寻迹红色</div>
          </a>
        </li>
        <li class="enter">
          <!-- 未登录时登录 -->
          <div id="unLogin">
            <a href="netlogin.html">登录</a> |
            <a href="netregister.html">注册</a>

          </div>
          <!-- 已登录时显示 -->
          <div id="alreadyLogin">
            <span id="name" style="cursor: pointer;">null</span>
            <span id="loginOut" style="margin-left: 10px;cursor: pointer">退出</span>
          </div>
        </li>
      </ul>
      <div id="arrow"></div>
    </div>
  </div>

  <!-- 顶部 -->
  <div class="header-wrapper">

    <!-- 顶部 搜索框 -->
    <div class="search-area-wrapper">
      <div class="search-area container">
      </div>
    </div>
    <!-- 搜索框 -->

  <!-- 内容 -->
  <div class="page-container">
    <div class="container">

      <ul class="breadcrumb">
        <li><a href="articles-list.html">活动广场</a><span class="divider">/</span></li>
        <li><a href="center.html">个人中心</a><span class="divider">/</span></li>
        <li class="active">修改密码</a></li>
      </ul>

      <!-- 页面内容 -->
      <div class="selfCenter">
        <!--个人中心 顶部-->
        <div class="sC-information">
          <div class="img-width">
          <img src="img/support.png">
          </div>
          <div class="float-left">
            <a href="#">
              <h3 id="userName" class="title"></h3>
            </a>
            <h4 id="signature" class="intro"></h4>
          </div>
          <!--<div class="btn-change">-->
          <!--<a href="#" title="修改资料"><button value="btn-change"><strong>退出登录</strong></button></a>-->
          <!--</div>-->
        </div>
        <!--选项栏-->
        <div class="sC-container">
          <!-- 右侧信息 -->
          <aside class="sC-choose page-sidebar">

            <section class="widget">
              <!--个人中心-->
              <div class="support-text">
                <ul>
                  <li>
                    <a href="center.html">
                      <p>个人中心</p>
                    </a>
                  </li>
                  <li>
                    <a href="changePassword.html">
                      <p>修改密码</p>
                    </a>
                  </li>
                  <li>
                    <a href="articles-list.html">
                      <p>活动广场</p>
                    </a>
                  </li>
                  <li>
                    <a href="myFavorite.html">
                      <p>我的收藏</p>
                    </a>
                  </li>
                  <li>
                    <a href="comment.html">
                      <p>与我相关</p>
                    </a>
                  </li>
                  <li><a href="myComment.html">
                      <p>我的评论</p>
                    </a>
                  </li>
                  <li>
                    <a href="history.html">
                      <p>浏览记录</p>
                    </a>
                  </li>
                </ul>
              </div>
            </section>
          </aside>
          <!--个人中心 end -->

          <!--内容面板-->
          <div class="sC-appear">
            <div class="sCInfo">
              <span>原 &NegativeVeryThinSpace; 密 &NegativeVeryThinSpace; 码：</span>
              <input class="oldPassWord" name="uPriPsw" type="text" value="" maxlength="16">
              <a href="#forgotPW" id="forg" data-toggle="modal">忘记密码？</a>
            </div>

            <div class="sCInfo">
              <span>新 &NegativeVeryThinSpace; 密 &NegativeVeryThinSpace; 码：</span>
              <input class="txtPassWord" name="uNewPsw" type="password" value="" maxlength="16" >
            </div>
            <div class="sCInfo">
              <span>确认密码：</span>
              <input class="txtPassWordAgain" name="uConfPsw" type="password" value="" maxlength="16">
            </div>
            <div class="sCInfo">
              <div class="btn-change2">
                <button id="update">完成</button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
  <!--内容 end-->



  <footer class="foot">
    <p>版权&copy;嘉应学院&nbsp;|&nbsp;地理科学与旅游学院&nbsp;|&nbsp;GIS专业&nbsp;|&nbsp;219团队<br>
      地址：广东省梅州市梅松路嘉应学院校本部&nbsp;&nbsp;邮编：514000&nbsp;&nbsp;维护：219团队<br>
      申明：本网页不做任何商业用途，只做教学实验，最终解释权归团队所有！
    </p>
  </footer>
  <a href="#top" id="scroll-top"></a>

  <!-- script -->
  <script src="js/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery-1.11.3.min.js"></script>
  <script src="js/jquery-1.9.1.min.js"></script>
  <script src="js/owl.carousel.js"></script>
  <script src="js/jquery.mixitup.js" type="text/javascript"></script>
  <script type="text/javascript" src="js/jquery.quovolver.js"></script>
  <script src="layer/layer.js"></script>

  <script>
      var newPassword;
      var oldPassword;
      $(document).ready(function () {
          //获得登录状态
          $.post("/user/checkUserstatus", {}, function (result) {
              if (result.code == 1) { //用户已登录
                  $("#unLogin").hide();
                  $("#alreadyLogin").show();
                  //取得用户昵称
                  var name = result.data.uname;
                  var sex = result.data.sex;
                  if (name == null) {
                      $("#name").html("请设置昵称");
                      $("#userName").append("昵称未设置");
                  } else {
                      $("#name").html(name);
                      $("#userName").append(name);
                  }
                  $("#signature").html(result.data.signature);
                  $("#userName").html(name);
              } else {
                  $("#alreadyLogin").hide();
                  alert("未登录，请登录后使用该模块！");
                  window.location.href = "netlogin.html";
              }
          }, "json");

      });

      //忘记密码
      $("#forgotPW").click(function () {

      });

      //修改密码
      $("#update").click(function () {
          if(oldPassword==undefined){
              layer.msg('请输入原密码！', {icon: 0});
              return;
          }
          if(oldPassword.length<=0){
              layer.msg('请输入原密码！', {icon: 0});
              return;
          }

          if (checkPassword() && checkPasswordIsSame()) { //全部格式正确,发送修改请求
              $.post("/user/updatePassword", {
                  "oldPassword": oldPassword,
                  "newPassword":newPassword
              }, function(data) {
                  //回调函数
                  if(data.code==1){//修改成功
                      layer.msg('密码修改成功！', {icon: 6});
                  }else {
                      layer.msg('修改失败，请检查原密码是否正确！', {icon: 5});
                  }
              }, "json");
          }
      });

      //退出用户
      $("#loginOut").click(function () {
          $.post("/user/loginOut", {}, function (response) {
          }, "json");
          window.location.href = "articles-list.html";
      });

$("#forg").click(function () {
    layer.msg('请联系网站管理员进行身份验证和密码重置', {icon: 0});
});

      //校验密码合法性
      function checkPassword() {
          var password = $(".txtPassWord").val();
          // 密码必须包含大小写字母和数字的组合，不使用特殊字符，长度在8-16之间
          var uPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9]{8,16}$/;
          return uPattern.test(password);
      }
      // 检查密码是否一致
      function checkPasswordIsSame() {
          var password = $(".txtPassWord").val();
          var passwordAgain = $(".txtPassWordAgain").val();
          if (password === passwordAgain) {
              return true;
          }
      }

      $(".oldPassWord").keyup(function() {
              oldPassword = $(".oldPassWord").val();
      });

      $(".txtPassWord").keyup(function() {
          if (!checkPassword()) { //校验失败
              layer.tips('密码必须包含大小写字母和数字的组合，不使用特殊字符，长度在8-16之间!', '.txtPassWord');
          } else {
              layer.tips('格式正确√', '.txtPassWord');
              newPassword = $(".txtPassWord").val();
          }
      });
      $(".txtPassWordAgain").keyup(function() {
          if (!checkPasswordIsSame()) { //校验失败
              layer.tips('密码输入不一致!', '.txtPassWordAgain');
          } else {
              layer.tips('密码一致√', '.txtPassWordAgain');
          }
      });
  </script>

</body>
<!-- 
<script>
  $(function () {
    $('#manInfo').load("mainInfo.html");
  })
</script> -->

</html>
<!doctype html>
<!--[if lt IE 7]>
<html class="lt-ie9 lt-ie8 lt-ie7" lang="en-US"> <![endif]-->
<!--[if IE 7]>
<html class="lt-ie9 lt-ie8" lang="en-US"> <![endif]-->
<!--[if IE 8]>
<html class="lt-ie9" lang="en-US"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en-US">
<!--<![endif]-->

<head>
    <!-- META TAGS -->
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>寻迹红色-活动广场</title>

    <!-- Style Sheet-->
    <link rel='stylesheet' id='bootstrap-css-css' href='css/bootstrap5152.css?ver=1.0' type='text/css' media='all'/>
    <link rel='stylesheet' id='responsive-css-css' href='css/responsive5152.css?ver=1.0' type='text/css' media='all'/>
    <link rel='stylesheet' id='main-css-css' href='css/main5152.css?ver=1.0' type='text/css' media='all'/>
    <link rel="stylesheet" href="enitormd/css/editormd.min.css"/>
    <link rel="stylesheet" href="css/layui.css"/>
    <!--<link rel='stylesheet' id='custom-css-css' href='../css/custom5152.html?ver=1.0' type='text/css' media='all' />-->
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>

    <![endif]-->


</head>

<body style="background-image: url(img/bg1.png);">
<!--导航 starts-->
<div style="background-color: snow;z-index: 1 !important;"  id="header">
    <div id="headerMain">
        <a href="index.html" id="logo">
            <img src="img/logo-red.png">
        </a>
        <ul id="nav">
            <li>
                <a href="javascript:">
                    <div class="up"><img src="img/home_gruen.png"></div>
                    <div><img src="img/home_red.png"></div>
                </a>
            </li>
            <li>
                <a href="#">
                    <div class="up"></div>
                    <div>红色地图</div>
                </a>
            </li>
            <li>
                <a href="great.html">
                    <div class="up"></div>
                    <div>红色人物</div>
                </a>
            </li>
            <li>
                <a href="secnics.html">
                    <div class="up"></div>
                    <div>红色景点</div>
                </a>
            </li>
            <li>
                <a href="articles-list.html" class="active">
                    <div>寻迹红色</div>
                </a>
            </li>
            <li class="enter">
                <!-- 未登录时登录 -->
                <div id="unLogin">
                    <a href="netlogin.html">登录</a> |
                    <a href="netregister.html">注册</a>

                </div>
                <!-- 已登录时显示 -->
                <div id="alreadyLogin">
                    <span id="name" style="cursor: pointer;">null</span>
                    <span id="loginOut" style="margin-left: 10px;cursor: pointer">退出</span>
                </div>
            </li>
        </ul>
        <div id="arrow"></div>
    </div>
</div>



<!--富文本-->
<div style="padding-top: 70px" id="layout">
    <div  style="padding-left: 400px" class="input-group input-group-lg">
        <select  id="select" style="height: 40px;width: 100px" name="city" lay-verify="">
            <option value="">帖子分类</option>
            <option value="热门路线">热门路线</option>
            <option value="经典路线">经典路线</option>
        </select>
        <input id="title" type="text" style="width: 60%;height: 30px;margin-left: 5px;padding-left: 15px" class="form-control" placeholder="请输入文章标题" aria-describedby="sizing-addon3">
        <input id="introduction" type="text" style="width: 60%;height: 30px;margin-left: 110px;padding-left: 15px" class="form-control" placeholder="请输入文章简介" aria-describedby="sizing-addon3">
    </div>



    <div id="md-content" style="z-index: 1 !important;">
                <textarea style="display:none;"></textarea>
    </div>
</div>
<!--富文本[结束]-->
    <button id="back" style="margin-left: 1300px" type="button" class="layui-btn layui-btn-radius layui-btn-lg layui-btn-normal">返回</button>
    <button id="wantPost" style="margin-left: 50px" type="button" class="layui-btn layui-btn-lg layui-btn-radius">提交</button>



<footer class="foot">
    <p>版权&copy;嘉应学院&nbsp;|&nbsp;地理科学与旅游学院&nbsp;|&nbsp;GIS专业&nbsp;|&nbsp;219团队<br>
        地址：广东省梅州市梅松路嘉应学院校本部&nbsp;&nbsp;邮编：514000&nbsp;&nbsp;维护：219团队<br>
        申明：本网页不做任何商业用途，只做教学实验，最终解释权归团队所有！
    </p>
</footer>
<a href="#top" id="scroll-top"></a>


<!-- script -->
<script type='text/javascript' src='js/jquery-1.8.3.min.js'></script>
<script type='text/javascript' src='js/jquery.easing.1.34e44.js?ver=1.3'></script>
<script type='text/javascript' src='js/jquery.liveSearchd5f7.js?ver=2.0'></script>
<script type='text/javascript' src='js/jflickrfeed.js'></script>
<script type='text/javascript' src='js/jquery.validate.minfc6b.js?ver=1.10.0'></script>
<script type='text/javascript' src='js/custom5152.js?ver=1.0'></script>
<script type="text/javascript" src="enitormd/editormd.min.js" ></script>
<script src="layer/layer.js"></script>
<script type="text/javascript" src="js/layui.js"></script>

</body >

<script>
    //设置为同步请求
    $.ajaxSetup({
        async: false
    });
    //Markdown初始化
    var contentEditor;

    $(function() {
        contentEditor = editormd("md-content", {
            width   : "80%",
            height  : 640,
            syncScrolling : "single",
            path    : "enitormd/lib/",
            saveHTMLToTextarea:true,
            emoji:true
        });


    });




    $(document).ready(function () {
            //获得登录状态
        $.post("/user/checkUserstatus", {}, function (result) {
            if (result.code == 1) { //用户已登录
                $("#unLogin").hide();
                $("#alreadyLogin").show();
            //取得用户昵称
                var name = result.data.uname;
                if (name == null) {
                    $("#name").html("请设置昵称");
                    $("#userName").append("昵称未设置");
                    setTimeout(function(){
                        layer.msg('您的昵称尚未设置，为了不影响您的正常使用，  请前往个人中心设置相关信息!');
                    }, 1000);
                } else {
                    $("#name").html(name);
                    $("#userName").append(name);
//                    $("#signature").html(result.data.signature);
                }
            } else {
                $("#alreadyLogin").hide();
                layer.msg('未登录，请登录后尝试！', {icon: 0});
                window.location.href = "articles-list.html";
            }
        }, "json");

    });
    var userId;//发帖用户id
    var type;//帖子类型
    var title;//帖子标题,,限制在20个字以内
    var introduction;//帖子简介
    var mainText;//正文
       //发帖
    $("#wantPost").click(function () {
        //获得登录状态
        $.post("/user/checkUserstatus", {}, function (result) {
            if (result.code == 1) { //用户已登录，获得用户id
                userId=result.data.uid;
            } else {
                layer.msg('未登录，请登录后尝试！', {icon: 0});
                return;
            }
        }, "json");
        type = $("#select").val();
        title=$("#title").val();
        introduction=$("#introduction").val();
        mainText=contentEditor.getHTML();
        console.log(mainText);
        if(type==""){
            layer.msg('请在上方选择帖子分类！', {icon: 0});
            return;
        }
        if(title.length<5){
            layer.msg('文章标题需要5个字以上！', {icon: 0});
            return;
        }
        if(title.length>20){
            layer.msg('请浓缩您的标题在20个字以内！', {icon: 0});
            return;
        }
        if(introduction.length<10){
            layer.msg('文章简介需要10个字以上！', {icon: 0});
            return;
        }
        if(mainText==""){
            layer.msg('帖子内容不能为空!', {icon: 0});
            return;
        }
        //发送
        $.post("/post/sendPost", {"userId":userId,"type":type,"title":title,"mainText":mainText,"introduction":introduction}, function (result) {
            if (result.code == 1) { //用户发帖成功，跳转到发表的帖子详情
                layer.msg('发表成功,正在跳转至帖子详情....', {icon: 6});
                window.location.href = "single.html?id="+result.data;
            } else {
                layer.msg('发帖失败，请稍后尝试！', {icon: 0});
                return;
            }
        }, "json");
    });

    //返回
$("#back").click(function () {
    window.location.href = "articles-list.html";
});

    //退出用户
    $("#loginOut").click(function () {
        $.post("/user/loginOut", {}, function (response) {
        }, "json");
        window.location.href = "articles-list.html";
    });
    //跳转至个人信息页
    $("#name").click(function () {
        window.location.href = "center.html";
    });
</script>

</html>